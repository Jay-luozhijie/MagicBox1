<div class="ms-4 me-4 mb-3">
    <div>Answers:</div>
    <% if(idea.answer.length> 0) {%>
        <%for(let answer of idea.answer){%>
            <div class='card mb-3 mt-3 mb-3'>
                <div class="card-body ms-3 mb-3">

                    <div>
                        <div class="answerAuthor mb-2">
                            <%=answer.author.username%>
                        </div>
                        <p>
                            <div id="carousel<%=answer._id%>" class="carousel slide" data-bs-interval="false"
                                data-bs-ride="carousel">
                                <div class="carousel-inner">
                                    <% answer.images.forEach(function(img,i) { %>
                                        <% if (i===0) {%>
                                            <div class="carousel-item active">
                                                <img style="max-width: 1000px; max-height: 500px;" src="<%=img.url%>"
                                                    class='d-block w-100' alt="">
                                            </div>
                                        <%} else {%>
                                                <div class="carousel-item">
                                                    <img style="max-width: 1000px; max-height: 500px;" src="<%=img.url%>"
                                                        class='d-block w-100' alt="">
                                                </div>
                                        <%}%>
                                    <% }) %>
                                </div>
                                <% if(answer.images.length>1){%>
                                    <button class="carousel-control-prev carousel-button" type="button"
                                        data-bs-target="#carousel<%=answer._id%>" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Previous</span>
                                    </button>
                                    <button class="carousel-control-next carousel-button" type="button"
                                        data-bs-target="#carousel<%=answer._id%>" data-bs-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Next</span>
                                    </button>
                                    <%}%>
                            </div>
                            <%-answer.content%>
                        </p>
                    </div>
                    <%if (currentUser) {%>
                        <%if(currentUser && answer.author.equals(currentUser._id)){%>
                            <form action='/<%=idea._id%>/answer/<%=answer._id%>?_method=DELETE' method="POST">
                                <button class='btn btn-sm btn-danger'>Delete</button>
                            </form>
                            <button class='answerEdit-btn btn btn-info btn-sm mt-2' id='answerEditBtn<%=answer._id%>'>
                                Edit
                            </button>
                        <%}%>      
                    <%}%>

                    <div class='answerEdit-modal' id="answerEditModal<%=answer._id%>">
                        <div class='answerEdit-modalHeader'>
                            <div class="answerEditTitle">Edit your answer</div>
                            <button class='answerEditClose-btn' id = 'answerEditCloseBtn<%=answer._id%>'>&times;</button>
                        </div>
                        <div class='answerEdit-modalBody'>
                            <form action="/<%=idea._id%>/answer/<%=answer._id%>?_method=PUT" class="validated-form my-3 mx-5" method="POST"
                                enctype="multipart/form-data" novalidate>
                                <label class='mb-2'>Share your product:</label>
                                <textarea class='textEditorArea' name="answerContent"
                                    placeholder="description:"><%-answer.content%></textarea>
                                <div class="mb-2 mt-3">
                                    <label class="mb-2">upload images:</label>
                                    <input class="form-control" type="file" id="answerImage" name='answerImage'
                                        multiple>
                                </div>
                                <div style='display:flex; flex-direction:column; justify-content: left;'>
                                    <% answer.images.forEach(function(img,i) { %>
                                        <img class='img-thumbnail' src="<%=img.url%>" alt="">
                                            <label for='image-<%=img.filename%>'>Delete</label>
                                            <input type='checkbox' name='deleteImages[]' value='<%=img.filename%>' id='image-<%=img.filename%>'>
                                    <%})%>
                                </div>
                                <div class='mt-3'>
                                    <button type="submit" class="btn" id='answerSubmit'>Save</button>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
            </div>
        <%}%>
    <%} else {%>
        <div>
            <p>This post hasn't received any answer.</p>
        </div>
    <%}%>
</div>
<div id='backgroundCover'>

</div>

<script>
    let answerEditBtn = document.querySelectorAll('.answerEdit-btn')                    //edit button
    for (let i = 0; i < answerEditBtn.length; i++) {
        answerEditBtn[i].addEventListener('click', function () {
            const answerId = answerEditBtn[i].id.slice(13)
            const answerEditModal = document.querySelector('#answerEditModal' + answerId)
            answerEditModal.style.transform = 'translate(-50%,-50%) scale(1)';  
            document.querySelector('#backgroundCover').style.visibility='visible'
            $('body').css('overflow','hidden')
        })
    }
    let answerEditCloseBtn = document.querySelectorAll('.answerEditClose-btn')          //close
    for(let i = 0; i < answerEditCloseBtn.length; i++){
        answerEditCloseBtn[i].addEventListener('click',function(){
            const answerId = answerEditCloseBtn[i].id.slice(18);
            const answerEditModal = document.querySelector('#answerEditModal' + answerId);
            answerEditModal.style.transform = 'translate(-50%,-50%) scale(0)';  
            document.querySelector('#backgroundCover').style.visibility='hidden';
            $('body').css('overflow','auto')
        })
    }
    
</script>